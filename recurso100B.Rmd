---
title: <span style="color:#034a94"> **Ordenar y limpiar los datos**</span> 
author: "Métodos y Simulación Estadística"
output:
  html_document:
    code_folding: hide
    css: style.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, comment = NA)

# install.packages('gtools')
# install.packages("TeachingSampling")

#load library
library(gtools)
library(TeachingSampling)
library(readr)
library(paqueteMET)

c1="#FF7F00"
c2="#034A94"
c3="#0EB0C6"
c4="#686868"

library(paqueteMET)
data("vivienda_faltantes")

```

</br></br>

<!-- ======================================================================= -->

Una de las tareas más importante al realizar un proyecto de Ciencia de Datos corresponde a la preparación de los datos (Limpieza de datos o data cleaning) que posteriormente va a permitir el modelamiento adecuado de los datos. 

Este ciclo comprende :

* Importación de los datos - ya tratado -
* Fusión de datos
* Datos faltantes
* Estandarización
* Normalización
* Elinación de registros duplicados
* Verificación y enrequecimiento
* Exportación de los datos

</br></br>

Al importar una base de datos que está conformada por una matriz con $n$ filas o registros  y $m$ columnas o variables se presentan problemas relacionados con:

* Datos faltantes (NA)
* Reemplazar los datos faltantes - imputación
* Datos extraños o  atípicos
* Necesidad de estandarizar los valores con el fin varias variables sean comparables (una misma escala)
* Construir nuevas variables a partir de las contenidas en la base
* Cambiar el formato de una variable - formato corto y formato largo -
* Aumentar los registros contenidos en dos bases - adicionar registros -
* Agregar variables contenidas en dos bases

</br></br>

A contunuación se presentan algunos de estos temas que permiten tratar y dejar lista la base de datos de interes para iniciar el análisis de datos

</br></br>

# <span style="color:#034a94">**Tratamiento de datos faltantes**


El tratamiento de datos faltantes es un aspecto crítico en Ciencia de Datos, ya que ellos pueden afectar de manera significativa la calidad y validez de los análisis y modelos que realicemos. Acontinuación se presentan algunas estrategias comunes para manejar los datos faltantes:

</br>

### <span style="color:#034a94">**1. Eliminacion de los registros  o filas**</span>

Si los **datos faltantes** son pocos en comparación con el tamaño total del conjunto de datos, una estrategia es eliminar los registros o filas que contienen datos faltantes. Sin embargo, esta estrategia puede llevar a una pérdida de información si los datos faltantes son sistemáticos o si se eliminan muchas observaciones en comparación con el tamaño de la base de datos.

</br>


### <span style="color:#FF7F00">**Ejemplo**

A partir de la base de datos `vivienda_faltantes` contenida en `paqueteMET`, se plantera examinar una muestra de ella de tamaño 1000 x 13 que se puede obtener con el siguiente código :


```{r}
library(paqueteMET)
library(dplyr)
data("vivienda_faltantes")
set.seed(123)
datosNA<-sample_n(vivienda_faltantes, 1000)
str(datosNA)
```

<br/>

La función  `str()`  se obtiene una visualización del tamaño de la base de datos, las variables que la conforman y el tipo de variables y una muesrta de los primeros valores.

Ahora para visualizar que variables y con que frecuencia se presentan los datos faltantes o `NA` utilizamos el siguiente código

<br/>

```{r}
faltantes <- colSums(is.na(datosNA))
faltantes
```

<br/><br/>


La función   `colSums(is.na(datosNA))`  totaliza  el número total de datos faltantes por variable para la data `datosNA`



<br/>


```{r, message=FALSE, warning=FALSE}
# install.packages("naniar")
library(naniar)
gg_miss_var(datosNA)
```


En esta gráfica podemos visualizar que las viables piso y parquea presentan datos faltantes, la primera al rededor de 340 y la segunda un poco más de 200 datos faltantes. Para ello se utiliza la función  `gg_miss_var(datosNA)`

</br></br>

Otra forma de detectar y representar gráficamente los datos faltantes es utilizando la función `md.pattern(datosNA, rotate.names = TRUE)`  del paquete `mice`



```{r}
# install.packages("mice")
library(mice)
grafico <-md.pattern(datosNA, rotate.names = TRUE)

```

En este caso se observa una primera fila que represnta los registros tienen informaciçon completa (sin datos faltantes). Las filas restantes donde aparecen cuadrados en rojo, registran los datos faltantes para las variables parqueadero y piso.

Detectados la proporción de datos faltantes procederemos como una primera estrategia a eliminarlos por completo


</br></br>

#### <span style="color:#686868">**Eliminación de datos faltantes**</span>


La función : `na.omit()`  , permite elimitar todos los registros contenidos en la base de datos que contenga datos faltantes (NA) 

```{r, eval=FALSE}
# install.packages("mice")
library(mice)
datosSINA <- na.omit(datosNA)  # elimina todos los valores con  NA
grafico <-md.pattern(datosSINA, rotate.names = TRUE)
```

* **Verifique que se han eliminado los datos faltantes**

</br></br>

### <span style="color:#034a94">**2. Tratamiento de datos faltantes como una categoría** 

En el caso de variables categóricas o cualitativas sus valores faltantes se pueden encontrar a partir del modelamiento la sub-base con registros completos 

los datos faltantes pueden tener un significado propio y no deben ser imputados ni eliminados. En lugar de eso, puedes considerar tratar los datos faltantes como una categoría adicional en el análisis o modelo.



</br>


```{r}
datosNA$faltante =0
datosNA$faltante[is.na(datosNA$parquea)] <-1 
grafico <-md.pattern(datosNA, rotate.names = TRUE)
# Categoría datos faltantes
table(datosNA$faltante)
```

</br></br>

## <span style="color:#034a94">**2. Imputación de valores**</span> 


Si no se desea eliminar los registros que contiene datos faltantes,  dado que se puede perder un gran porcentaje de la información, entoces se recurre a reemplazar estos valores, primero calculado el valor por el cual se debe reemplazar (**imputación de datos**). 

Para realizar este procedimiento se tienen varias alternativas, cambiando los datos faltantes por :

* cero
* la media
* mediana
* por el valor de un registro completo semejante al del dato faltante - tecnicas avanzadas de imputación -
 
</br></br>

### <span style="color:#FF7F00">**Ejemplo**</span>

####  <span style="color:#686868">**Caso imputación por cero**</span>

En el caso de la data vivienda_faltantes, es posible que los  propietarios al ser interrogados, entendieron que no debian responder la pregunta: **Número de parqueaderes**, cuando su vivienda no posee parqueadero. 

En otros casos es posible que se trate de un dato faltante real y se deba reeplazar por la media por ejemplo

El caso de reemplazar los  NA por **cero** procederemos así:


```{r}
datosNA$parquea[is.na(datosNA$parquea)] <- 0
grafico <-md.pattern(datosNA, rotate.names = TRUE)
```


</br></br>

#### <span style="color:#686868">**Caso reemplazo por la media**</span> 

En el caso de reemplazar el NA por el valor correspondiente a la media se asigna este valor de la siguiente manera:

```{r, message=FALSE, warning=FALSE}
# Calcula la media de la variable "parquea"
media_parquea <- mean(datosNA$parquea, na.rm = TRUE) %>%
                    round(,0)

datosNA$parquea[is.na(datosNA$parquea)] <- media_parquea
grafico <-md.pattern(datosNA, rotate.names = TRUE)

```
<div class="content-box-gray">
### <span style="color:#686868">**Nota**</span>

Dado que la variable número de parqueaderos es un valor entero, se aproxima al entero más cercano con la función `round()`

<</div>


</br></br>

#### <span style="color:#686868">**Caso reemplazo por la mediana**</span> 

En el caso de reemplazar el NA por el valor correspondiente a la mediana se asigna este valor de la siguiente manera:

```{r, message=FALSE, warning=FALSE}
# Calcula la media de la variable "parquea"
mediana_parquea <- median(datosNA$parquea, na.rm = TRUE) %>%
                    round(,0)

datosNA$parquea[is.na(datosNA$parquea)] <- mediana_parquea
grafico <-md.pattern(datosNA, rotate.names = TRUE)

```




</br></br>

#### <span style="color:#686868">**Caso reemplazo por la moda**</span> 

En el caso de la variable piso, que corresponde cualitativa de escala ordinal, si se desea reemplazar por la moda a los datos faltantes procedemos de la siguiente forma:

```{r, message=FALSE, warning=FALSE}

# install.packages("DescTools")
library(DescTools)
moda_piso <- Mode(datosNA$piso, na.rm = TRUE)
datosNA$piso[is.na(datosNA$piso)] <- moda_piso
grafico <-md.pattern(datosNA, rotate.names = TRUE)

```

</br></br>

### <span style="color:#034a94">**3. Técnicas más avanzadas**</span>

Los valores faltantes pueden ser reemplazados por valores obtenidos a a partir modelos, donde se construyen para estimar los valores faltantes de manera predictiva.

Existen métodos Aavanzados para imputar datos faltantes, como la imputación múltiple (multiple imputation) y la imputación basada en modelos de aprendizaje automático. Estos enfoques generan múltiples conjuntos de datos imputados y tienen en cuenta la incertidumbre asociada con la imputación. Los cuales serán tratado mas adelante.

</br>

Es importante evaluar cuidadosamente el patrón y la naturaleza de los datos faltantes antes de decidir qué estrategia utilizar. Además, es fundamental tener en cuenta que los método de imputación introduce incertidumbre y puede afectar los resultados de los análisis o modelos. Por lo tanto, es recomendable documentar y tener en cuenta el proceso de imputación en el análisis y la interpretación de los resultados.








